---
title: 震惊!57行代码实现刷在线时长 
date: 2019-05-28 21:50:07
tags: Node.js 
---
不知道大家有没这样的经验，有些网站下载东西需要积分，而在线时间可以积累积分，但是网页15分钟就会超时，你需要一直开着浏览器并刷新，要是有个脚本一直在后台跑着就好了，24小时在线，这就是我们要写的内容。

因为此类网站很多，我也不可能一篇盖全。所以我们便用学校的一个需要刷在线时长的网站演示。
<!-- more -->
## 项目介绍

> 我们学校大学语文的计分方式是通过其在线时长的积累，需要在网站上浏览1000分钟的内容，但是网站上即没有视频也没有文章，就是让你傻傻的浏览。所以我写了这个小工具，帮助大家自动刷满时长。

### whut-zgyw

项目地址： 
> Github 地址 ：https://github.com/Reyunn/whut-zgyw

项目依赖：

- require
- cheerio

### 项目使用

嘿嘿，我在这里先教大家使用，在慢慢分析其原理与思想。

#### 安装运行环境：

因为本项目是基于Node.js开发的，所以你需要前往Node.js的网站安装最新版的Node.js。

> Node.js官网 ：https://nodejs.org/en/

#### 获取本项目：

这里默认大家都会使用Git了，所以直接将我的项目Clone下来就好。如果大家普遍反馈还不会Git的话，我后续会推出几篇文章，带你认识认识Git。

```bash
git clone https://github.com/Reyunn/whut-zgyw.git
```

#### 安装依赖：

```bash
npm install
```

#### 运行：

```javascript
node index.js 学号 密码
//如 node index.js 0121709360222 0121709360222
```

### 运行效果图

![](http://ww1.sinaimg.cn/large/00613kQPgy1g3bl8xwdvwj30xz0hrtbd.jpg)

> 成功运行后你会发现脚本每分钟都会自动执行一次，最终帮你刷满1000分钟。

## 代码分析

到此你已经能实现帮自己和同学完成这1000分钟的内容，如果你想弄清楚其中的原理，那就耐心往后看。希望下面的文字能对你有所启发。

## 代码

![](http://ww1.sinaimg.cn/large/00613kQPgy1g3h6s0t5y9j31kw1weqh8.jpg)

所有的代码由两个函数和3句命令构成。我们将此代码的执行流程带你分析一下这个项目。

## 引用与定义

```javascript
const cheerio = require("cheerio");
const request = require("request");
const URL = "http://59.69.102.9/zgyw/index.aspx";
const URL_ARTICLE = "http://59.69.102.9/zgyw/study/LearningContent.aspx?type=1&id=1&learningid=3073";
let cookie = "";
```

对于变量的类型采样ES6标准编写，即常量为`const`变量为`let`，在这里我引用了两个第三方模块`cheerio`与`request`分别起着`解析网页`与`发送请求`的作用。常量`URL`是我们登入及点击主页的地址。`URL_ARTICLE`是我们模拟浏览的地址。而变量`cookie`则是我们记录网站cookie的变量。

### 主函数

```javascript
const args = process.argv.splice(2);
if (args.length != 2) console.log("请输入用户名和密码！");
f();
```

这里我们用`args`接受`cmd`传入的用户名及密码，并提醒用户正确输入信息。此后执行f()函数，此函数是本

项目的主要部分。

### f() 函数

```javascript
async function f() {
    setTimeout(f, 60000);
    await request({
        url: URL_ARTICLE,
        headers: {
            'Cookie': cookie
        }
    }, () => {
    });
    await request({
            url: URL,
            headers: {
                'Cookie': cookie
            }
        },
        (error, response, body) => {
            if (!error && response.statusCode == 200) {
                const $ = cheerio.load(body.toString());
                if ($("#ctl00_ContentPlaceHolder1_lblonlineTime font").html() != null) {
                    const time_temp = parseInt($("#ctl00_ContentPlaceHolder1_lblonlineTime font").html().substring(0, 4));
                    console.log(new Date() + " " + args[0] + " " + time_temp);
                } else {
                    login();
                }
            }
        });
}
```

首先我将其设置为`async`函数，因为我们需要以同步的方式实现该功能。这个函数仅三条内容

- > setTimeout(f, 60000);  实现该函数每1分钟，自动执行。     
- > 第一个request请求，浏览文章
- > 第二个request请求，浏览主页，并判断是否登入，若未登入执行登入操作，若登入成功则打印目前时长。

# 感谢阅读

![](https://ly-object-1259106193.cos.ap-chengdu.myqcloud.com/whut-electronic.jpg)

  
---  
<div align=right>author:Reyunn</div>